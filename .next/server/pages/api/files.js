"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/files";
exports.ids = ["pages/api/files"];
exports.modules = {

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "node-telegram-bot-api":
/*!****************************************!*\
  !*** external "node-telegram-bot-api" ***!
  \****************************************/
/***/ ((module) => {

module.exports = require("node-telegram-bot-api");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "@upstash/redis":
/*!*********************************!*\
  !*** external "@upstash/redis" ***!
  \*********************************/
/***/ ((module) => {

module.exports = import("@upstash/redis");;

/***/ }),

/***/ "axios":
/*!************************!*\
  !*** external "axios" ***!
  \************************/
/***/ ((module) => {

module.exports = import("axios");;

/***/ }),

/***/ "formidable":
/*!*****************************!*\
  !*** external "formidable" ***!
  \*****************************/
/***/ ((module) => {

module.exports = import("formidable");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ffiles&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cfiles.js&middlewareConfigBase64=e30%3D!":
/*!****************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ffiles&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cfiles.js&middlewareConfigBase64=e30%3D! ***!
  \****************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/future/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(api)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_files_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\files.js */ \"(api)/./pages/api/files.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_files_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_files_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_files_js__WEBPACK_IMPORTED_MODULE_3__, \"default\"));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_files_js__WEBPACK_IMPORTED_MODULE_3__, \"config\");\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_future_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/files\",\n        pathname: \"/api/files\",\n        // The following aren't used in production.\n        bundlePath: \"\",\n        filename: \"\"\n    },\n    userland: _pages_api_files_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmZpbGVzJnByZWZlcnJlZFJlZ2lvbj0mYWJzb2x1dGVQYWdlUGF0aD0uJTJGcGFnZXMlNUNhcGklNUNmaWxlcy5qcyZtaWRkbGV3YXJlQ29uZmlnQmFzZTY0PWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDTDtBQUMxRDtBQUNtRDtBQUNuRDtBQUNBLGlFQUFlLHdFQUFLLENBQUMsZ0RBQVEsWUFBWSxFQUFDO0FBQzFDO0FBQ08sZUFBZSx3RUFBSyxDQUFDLGdEQUFRO0FBQ3BDO0FBQ08sd0JBQXdCLGdIQUFtQjtBQUNsRDtBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTCxZQUFZO0FBQ1osQ0FBQzs7QUFFRCxxQyIsInNvdXJjZXMiOlsid2VicGFjazovL3RnLW5ldC1idWNrZXQvPzY5YmYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgUGFnZXNBUElSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL3BhZ2VzLWFwaS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzXFxcXGFwaVxcXFxmaWxlcy5qc1wiO1xuLy8gUmUtZXhwb3J0IHRoZSBoYW5kbGVyIChzaG91bGQgYmUgdGhlIGRlZmF1bHQgZXhwb3J0KS5cbmV4cG9ydCBkZWZhdWx0IGhvaXN0KHVzZXJsYW5kLCBcImRlZmF1bHRcIik7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCBcImNvbmZpZ1wiKTtcbi8vIENyZWF0ZSBhbmQgZXhwb3J0IHRoZSByb3V0ZSBtb2R1bGUgdGhhdCB3aWxsIGJlIGNvbnN1bWVkLlxuZXhwb3J0IGNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IFBhZ2VzQVBJUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLlBBR0VTX0FQSSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2ZpbGVzXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvZmlsZXNcIixcbiAgICAgICAgLy8gVGhlIGZvbGxvd2luZyBhcmVuJ3QgdXNlZCBpbiBwcm9kdWN0aW9uLlxuICAgICAgICBidW5kbGVQYXRoOiBcIlwiLFxuICAgICAgICBmaWxlbmFtZTogXCJcIlxuICAgIH0sXG4gICAgdXNlcmxhbmRcbn0pO1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1wYWdlcy1hcGkuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ffiles&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cfiles.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/files.js":
/*!****************************!*\
  !*** ./pages/api/files.js ***!
  \****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var _src_telegram_storage__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../../src/telegram_storage */ \"(api)/./src/telegram_storage.js\");\n/* harmony import */ var formidable__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! formidable */ \"formidable\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_2__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_src_telegram_storage__WEBPACK_IMPORTED_MODULE_0__, formidable__WEBPACK_IMPORTED_MODULE_1__]);\n([_src_telegram_storage__WEBPACK_IMPORTED_MODULE_0__, formidable__WEBPACK_IMPORTED_MODULE_1__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\n// 禁用Next.js的默认body解析，以便处理文件上传\nconst config = {\n    api: {\n        bodyParser: false\n    }\n};\n/**\n * 验证环境变量是否配置正确\n * @returns {Object} 验证结果\n */ function validateEnvironmentVariables() {\n    const botToken = process.env.TELEGRAM_BOT_TOKEN;\n    const chatId = process.env.TELEGRAM_CHAT_ID;\n    if (!botToken) {\n        return {\n            valid: false,\n            error: \"缺少环境变量 TELEGRAM_BOT_TOKEN\"\n        };\n    }\n    if (!chatId) {\n        return {\n            valid: false,\n            error: \"缺少环境变量 TELEGRAM_CHAT_ID\"\n        };\n    }\n    return {\n        valid: true,\n        botToken,\n        chatId\n    };\n}\nasync function handler(req, res) {\n    const { method } = req;\n    // 验证环境变量\n    const envValidation = validateEnvironmentVariables();\n    if (!envValidation.valid) {\n        return res.status(500).json({\n            success: false,\n            error: `配置错误: ${envValidation.error}`\n        });\n    }\n    // 创建TelegramStorage实例\n    const telegramStorage = new _src_telegram_storage__WEBPACK_IMPORTED_MODULE_0__.TelegramStorage({\n        botToken: envValidation.botToken,\n        chatId: envValidation.chatId\n    });\n    switch(method){\n        case \"GET\":\n            // 获取文件列表\n            try {\n                const files = await telegramStorage.listFiles();\n                res.status(200).json({\n                    success: true,\n                    files\n                });\n            } catch (error) {\n                res.status(500).json({\n                    success: false,\n                    error: error.message\n                });\n            }\n            break;\n        case \"POST\":\n            // 上传文件\n            try {\n                const form = new formidable__WEBPACK_IMPORTED_MODULE_1__.IncomingForm();\n                form.parse(req, async (err, fields, files)=>{\n                    if (err) {\n                        console.error(\"文件解析错误:\", err);\n                        return res.status(500).json({\n                            success: false,\n                            error: `文件解析失败: ${err.message}`\n                        });\n                    }\n                    // 在formidable v3中，files.file是一个数组\n                    const fileArray = files.file;\n                    if (!fileArray || !Array.isArray(fileArray) || fileArray.length === 0) {\n                        console.error(\"没有提供文件\");\n                        return res.status(400).json({\n                            success: false,\n                            error: \"没有提供文件\"\n                        });\n                    }\n                    const file = fileArray[0]; // 获取第一个文件\n                    if (!file || !file.filepath) {\n                        console.error(\"文件对象无效或缺少文件路径\");\n                        return res.status(400).json({\n                            success: false,\n                            error: \"文件对象无效或缺少文件路径\"\n                        });\n                    }\n                    try {\n                        console.log(`开始上传文件: ${file.originalFilename}, 大小: ${file.size} bytes`);\n                        const fileBuffer = fs__WEBPACK_IMPORTED_MODULE_2___default().readFileSync(file.filepath);\n                        const result = await telegramStorage.uploadFile(fileBuffer, file.originalFilename);\n                        console.log(`文件上传成功: ${file.originalFilename}, fileId: ${result.fileId}`);\n                        res.status(200).json({\n                            success: true,\n                            fileId: result.fileId,\n                            messageId: result.messageId\n                        });\n                    } catch (uploadError) {\n                        console.error(\"文件上传到Telegram失败:\", uploadError);\n                        return res.status(500).json({\n                            success: false,\n                            error: `上传失败: ${uploadError.message}`\n                        });\n                    }\n                });\n            } catch (error) {\n                console.error(\"POST请求处理错误:\", error);\n                res.status(500).json({\n                    success: false,\n                    error: `请求处理失败: ${error.message}`\n                });\n            }\n            break;\n        case \"DELETE\":\n            // 删除文件\n            try {\n                const { messageId } = req.query;\n                if (!messageId) {\n                    return res.status(400).json({\n                        success: false,\n                        error: \"没有提供消息ID\"\n                    });\n                }\n                const result = await telegramStorage.deleteFile(messageId);\n                res.status(200).json({\n                    success: true,\n                    result\n                });\n            } catch (error) {\n                res.status(500).json({\n                    success: false,\n                    error: error.message\n                });\n            }\n            break;\n        default:\n            res.setHeader(\"Allow\", [\n                \"GET\",\n                \"POST\",\n                \"DELETE\"\n            ]);\n            res.status(405).end(`Method ${method} Not Allowed`);\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFNNkIsU0FBUyxNQUFNcEIsZ0JBQWdCMEIsVUFBVSxDQUFDSDtnQkFDaEQ3QixJQUFJRyxNQUFNLENBQUMsS0FBS0MsSUFBSSxDQUFDO29CQUFFQyxTQUFTO29CQUFNcUI7Z0JBQU87WUFDL0MsRUFBRSxPQUFPN0IsT0FBTztnQkFDZEcsSUFBSUcsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztvQkFBRUMsU0FBUztvQkFBT1IsT0FBT0EsTUFBTVksT0FBTztnQkFBQztZQUM5RDtZQUNBO1FBRUY7WUFDRVQsSUFBSWlDLFNBQVMsQ0FBQyxTQUFTO2dCQUFDO2dCQUFPO2dCQUFRO2FBQVM7WUFDaERqQyxJQUFJRyxNQUFNLENBQUMsS0FBSytCLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRWpDLE9BQU8sWUFBWSxDQUFDO0lBQ3REO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90Zy1uZXQtYnVja2V0Ly4vcGFnZXMvYXBpL2ZpbGVzLmpzPzJhZGQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgVGVsZWdyYW1TdG9yYWdlIH0gZnJvbSAnLi4vLi4vc3JjL3RlbGVncmFtX3N0b3JhZ2UnO1xuaW1wb3J0IHsgSW5jb21pbmdGb3JtIH0gZnJvbSAnZm9ybWlkYWJsZSc7XG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuXG4vLyDnpoHnlKhOZXh0Lmpz55qE6buY6K6kYm9keeino+aekO+8jOS7peS+v+WkhOeQhuaWh+S7tuS4iuS8oFxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcbiAgYXBpOiB7XG4gICAgYm9keVBhcnNlcjogZmFsc2UsXG4gIH0sXG59O1xuXG4vKipcbiAqIOmqjOivgeeOr+Wig+WPmOmHj+aYr+WQpumFjee9ruato+ehrlxuICogQHJldHVybnMge09iamVjdH0g6aqM6K+B57uT5p6cXG4gKi9cbmZ1bmN0aW9uIHZhbGlkYXRlRW52aXJvbm1lbnRWYXJpYWJsZXMoKSB7XG4gIGNvbnN0IGJvdFRva2VuID0gcHJvY2Vzcy5lbnYuVEVMRUdSQU1fQk9UX1RPS0VOO1xuICBjb25zdCBjaGF0SWQgPSBwcm9jZXNzLmVudi5URUxFR1JBTV9DSEFUX0lEO1xuICBcbiAgaWYgKCFib3RUb2tlbikge1xuICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICfnvLrlsJHnjq/looPlj5jph48gVEVMRUdSQU1fQk9UX1RPS0VOJyB9O1xuICB9XG4gIFxuICBpZiAoIWNoYXRJZCkge1xuICAgIHJldHVybiB7IHZhbGlkOiBmYWxzZSwgZXJyb3I6ICfnvLrlsJHnjq/looPlj5jph48gVEVMRUdSQU1fQ0hBVF9JRCcgfTtcbiAgfVxuICBcbiAgcmV0dXJuIHsgdmFsaWQ6IHRydWUsIGJvdFRva2VuLCBjaGF0SWQgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlcihyZXEsIHJlcykge1xuICBjb25zdCB7IG1ldGhvZCB9ID0gcmVxO1xuICBcbiAgLy8g6aqM6K+B546v5aKD5Y+Y6YePXG4gIGNvbnN0IGVudlZhbGlkYXRpb24gPSB2YWxpZGF0ZUVudmlyb25tZW50VmFyaWFibGVzKCk7XG4gIGlmICghZW52VmFsaWRhdGlvbi52YWxpZCkge1xuICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IFxuICAgICAgc3VjY2VzczogZmFsc2UsIFxuICAgICAgZXJyb3I6IGDphY3nva7plJnor686ICR7ZW52VmFsaWRhdGlvbi5lcnJvcn1gIFxuICAgIH0pO1xuICB9XG4gIFxuICAvLyDliJvlu7pUZWxlZ3JhbVN0b3JhZ2Xlrp7kvotcbiAgY29uc3QgdGVsZWdyYW1TdG9yYWdlID0gbmV3IFRlbGVncmFtU3RvcmFnZSh7XG4gICAgYm90VG9rZW46IGVudlZhbGlkYXRpb24uYm90VG9rZW4sXG4gICAgY2hhdElkOiBlbnZWYWxpZGF0aW9uLmNoYXRJZFxuICB9KTtcblxuICBzd2l0Y2ggKG1ldGhvZCkge1xuICAgIGNhc2UgJ0dFVCc6XG4gICAgICAvLyDojrflj5bmlofku7bliJfooahcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGZpbGVzID0gYXdhaXQgdGVsZWdyYW1TdG9yYWdlLmxpc3RGaWxlcygpO1xuICAgICAgICByZXMuc3RhdHVzKDIwMCkuanNvbih7IHN1Y2Nlc3M6IHRydWUsIGZpbGVzIH0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XG4gICAgICB9XG4gICAgICBicmVhaztcblxuICAgIGNhc2UgJ1BPU1QnOlxuICAgICAgLy8g5LiK5Lyg5paH5Lu2XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBmb3JtID0gbmV3IEluY29taW5nRm9ybSgpO1xuICAgICAgICBmb3JtLnBhcnNlKHJlcSwgYXN5bmMgKGVyciwgZmllbGRzLCBmaWxlcykgPT4ge1xuICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+aWh+S7tuino+aekOmUmeivrzonLCBlcnIpO1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgXG4gICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcbiAgICAgICAgICAgICAgZXJyb3I6IGDmlofku7bop6PmnpDlpLHotKU6ICR7ZXJyLm1lc3NhZ2V9YCBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIC8vIOWcqGZvcm1pZGFibGUgdjPkuK3vvIxmaWxlcy5maWxl5piv5LiA5Liq5pWw57uEXG4gICAgICAgICAgY29uc3QgZmlsZUFycmF5ID0gZmlsZXMuZmlsZTtcbiAgICAgICAgICBpZiAoIWZpbGVBcnJheSB8fCAhQXJyYXkuaXNBcnJheShmaWxlQXJyYXkpIHx8IGZpbGVBcnJheS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+ayoeacieaPkOS+m+aWh+S7ticpO1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgXG4gICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcbiAgICAgICAgICAgICAgZXJyb3I6ICfmsqHmnInmj5Dkvpvmlofku7YnIFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgY29uc3QgZmlsZSA9IGZpbGVBcnJheVswXTsgLy8g6I635Y+W56ys5LiA5Liq5paH5Lu2XG4gICAgICAgICAgaWYgKCFmaWxlIHx8ICFmaWxlLmZpbGVwYXRoKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCfmlofku7blr7nosaHml6DmlYjmiJbnvLrlsJHmlofku7bot6/lvoQnKTtcbiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IFxuICAgICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSwgXG4gICAgICAgICAgICAgIGVycm9yOiAn5paH5Lu25a+56LGh5peg5pWI5oiW57y65bCR5paH5Lu26Lev5b6EJyBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhg5byA5aeL5LiK5Lyg5paH5Lu2OiAke2ZpbGUub3JpZ2luYWxGaWxlbmFtZX0sIOWkp+WwjzogJHtmaWxlLnNpemV9IGJ5dGVzYCk7XG4gICAgICAgICAgICBjb25zdCBmaWxlQnVmZmVyID0gZnMucmVhZEZpbGVTeW5jKGZpbGUuZmlsZXBhdGgpO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGVsZWdyYW1TdG9yYWdlLnVwbG9hZEZpbGUoZmlsZUJ1ZmZlciwgZmlsZS5vcmlnaW5hbEZpbGVuYW1lKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgY29uc29sZS5sb2coYOaWh+S7tuS4iuS8oOaIkOWKnzogJHtmaWxlLm9yaWdpbmFsRmlsZW5hbWV9LCBmaWxlSWQ6ICR7cmVzdWx0LmZpbGVJZH1gKTtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgXG4gICAgICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsIFxuICAgICAgICAgICAgICBmaWxlSWQ6IHJlc3VsdC5maWxlSWQsIFxuICAgICAgICAgICAgICBtZXNzYWdlSWQ6IHJlc3VsdC5tZXNzYWdlSWQgXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9IGNhdGNoICh1cGxvYWRFcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcign5paH5Lu25LiK5Lyg5YiwVGVsZWdyYW3lpLHotKU6JywgdXBsb2FkRXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgXG4gICAgICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcbiAgICAgICAgICAgICAgZXJyb3I6IGDkuIrkvKDlpLHotKU6ICR7dXBsb2FkRXJyb3IubWVzc2FnZX1gIFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1BPU1Tor7fmsYLlpITnkIbplJnor686JywgZXJyb3IpO1xuICAgICAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IFxuICAgICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcbiAgICAgICAgICBlcnJvcjogYOivt+axguWkhOeQhuWksei0pTogJHtlcnJvci5tZXNzYWdlfWAgXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG5cbiAgICBjYXNlICdERUxFVEUnOlxuICAgICAgLy8g5Yig6Zmk5paH5Lu2XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7IG1lc3NhZ2VJZCB9ID0gcmVxLnF1ZXJ5O1xuICAgICAgICBpZiAoIW1lc3NhZ2VJZCkge1xuICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ+ayoeacieaPkOS+m+a2iOaBr0lEJyB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRlbGVncmFtU3RvcmFnZS5kZWxldGVGaWxlKG1lc3NhZ2VJZCk7XG4gICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHsgc3VjY2VzczogdHJ1ZSwgcmVzdWx0IH0pO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSk7XG4gICAgICB9XG4gICAgICBicmVhaztcblxuICAgIGRlZmF1bHQ6XG4gICAgICByZXMuc2V0SGVhZGVyKCdBbGxvdycsIFsnR0VUJywgJ1BPU1QnLCAnREVMRVRFJ10pO1xuICAgICAgcmVzLnN0YXR1cyg0MDUpLmVuZChgTWV0aG9kICR7bWV0aG9kfSBOb3QgQWxsb3dlZGApO1xuICB9XG59Il0sIm5hbWVzIjpbIlRlbGVncmFtU3RvcmFnZSIsIkluY29taW5nRm9ybSIsImZzIiwiY29uZmlnIiwiYXBpIiwiYm9keVBhcnNlciIsInZhbGlkYXRlRW52aXJvbm1lbnRWYXJpYWJsZXMiLCJib3RUb2tlbiIsInByb2Nlc3MiLCJlbnYiLCJURUxFR1JBTV9CT1RfVE9LRU4iLCJjaGF0SWQiLCJURUxFR1JBTV9DSEFUX0lEIiwidmFsaWQiLCJlcnJvciIsImhhbmRsZXIiLCJyZXEiLCJyZXMiLCJtZXRob2QiLCJlbnZWYWxpZGF0aW9uIiwic3RhdHVzIiwianNvbiIsInN1Y2Nlc3MiLCJ0ZWxlZ3JhbVN0b3JhZ2UiLCJmaWxlcyIsImxpc3RGaWxlcyIsIm1lc3NhZ2UiLCJmb3JtIiwicGFyc2UiLCJlcnIiLCJmaWVsZHMiLCJjb25zb2xlIiwiZmlsZUFycmF5IiwiZmlsZSIsIkFycmF5IiwiaXNBcnJheSIsImxlbmd0aCIsImZpbGVwYXRoIiwibG9nIiwib3JpZ2luYWxGaWxlbmFtZSIsInNpemUiLCJmaWxlQnVmZmVyIiwicmVhZEZpbGVTeW5jIiwicmVzdWx0IiwidXBsb2FkRmlsZSIsImZpbGVJZCIsIm1lc3NhZ2VJZCIsInVwbG9hZEVycm9yIiwicXVlcnkiLCJkZWxldGVGaWxlIiwic2V0SGVhZGVyIiwiZW5kIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/files.js\n");

/***/ }),

/***/ "(api)/./src/redis_client.js":
/*!*****************************!*\
  !*** ./src/redis_client.js ***!
  \*****************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   RedisClient: () => (/* binding */ RedisClient),\n/* harmony export */   redisClient: () => (/* binding */ redisClient)\n/* harmony export */ });\n/* harmony import */ var _upstash_redis__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @upstash/redis */ \"@upstash/redis\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_upstash_redis__WEBPACK_IMPORTED_MODULE_0__]);\n_upstash_redis__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n/**\r\n * Redis客户端配置和连接管理\r\n * 使用Upstash Redis作为持久化存储\r\n */ class RedisClient {\n    constructor(){\n        // 从环境变量获取Upstash Redis配置\n        this.redisUrl = process.env.UPSTASH_REDIS_REST_URL;\n        this.redisToken = process.env.UPSTASH_REDIS_REST_TOKEN;\n        if (!this.redisUrl || !this.redisToken) {\n            console.warn(\"Upstash Redis配置未找到，将使用内存存储（仅用于开发环境）\");\n            this.redis = null;\n            this.memoryStore = new Map(); // 开发环境的内存存储\n        } else {\n            // 初始化Upstash Redis客户端\n            this.redis = new _upstash_redis__WEBPACK_IMPORTED_MODULE_0__.Redis({\n                url: this.redisUrl,\n                token: this.redisToken\n            });\n        }\n    }\n    /**\r\n   * 获取Redis客户端实例\r\n   * @returns {Redis|null} Redis客户端实例或null（如果未配置）\r\n   */ getClient() {\n        return this.redis;\n    }\n    /**\r\n   * 检查Redis连接是否可用\r\n   * @returns {boolean} 连接状态\r\n   */ isConnected() {\n        return this.redis !== null;\n    }\n    /**\r\n   * 设置键值对\r\n   * @param {string} key - 键\r\n   * @param {any} value - 值\r\n   * @param {number} [ttl] - 过期时间（秒）\r\n   * @returns {Promise<boolean>} 操作结果\r\n   */ async set(key, value, ttl = null) {\n        try {\n            if (this.redis) {\n                const serializedValue = JSON.stringify(value);\n                if (ttl) {\n                    await this.redis.setex(key, ttl, serializedValue);\n                } else {\n                    await this.redis.set(key, serializedValue);\n                }\n                return true;\n            } else {\n                // 使用内存存储作为后备\n                this.memoryStore.set(key, {\n                    value,\n                    timestamp: Date.now(),\n                    ttl\n                });\n                return true;\n            }\n        } catch (error) {\n            console.error(\"Redis设置失败:\", error);\n            return false;\n        }\n    }\n    /**\r\n   * 获取值\r\n   * @param {string} key - 键\r\n   * @returns {Promise<any|null>} 值或null\r\n   */ async get(key) {\n        try {\n            if (this.redis) {\n                const value = await this.redis.get(key);\n                if (!value) return null;\n                // 安全的 JSON 解析\n                try {\n                    // 如果值已经是对象，直接返回\n                    if (typeof value === \"object\") {\n                        return value;\n                    }\n                    // 如果是字符串，尝试解析\n                    return JSON.parse(value);\n                } catch (parseError) {\n                    console.error(`JSON解析失败，key: ${key}, value:`, value, parseError);\n                    // 如果解析失败，删除无效数据\n                    await this.del(key);\n                    return null;\n                }\n            } else {\n                // 使用内存存储作为后备\n                const item = this.memoryStore.get(key);\n                if (!item) return null;\n                // 检查是否过期\n                if (item.ttl && Date.now() - item.timestamp > item.ttl * 1000) {\n                    this.memoryStore.delete(key);\n                    return null;\n                }\n                return item.value;\n            }\n        } catch (error) {\n            console.error(\"Redis获取失败:\", error);\n            return null;\n        }\n    }\n    /**\r\n   * 删除键\r\n   * @param {string} key - 键\r\n   * @returns {Promise<boolean>} 操作结果\r\n   */ async del(key) {\n        try {\n            if (this.redis) {\n                await this.redis.del(key);\n                return true;\n            } else {\n                // 使用内存存储作为后备\n                return this.memoryStore.delete(key);\n            }\n        } catch (error) {\n            console.error(\"Redis删除失败:\", error);\n            return false;\n        }\n    }\n    /**\r\n   * 向列表添加元素\r\n   * @param {string} key - 列表键\r\n   * @param {any} value - 要添加的值\r\n   * @returns {Promise<boolean>} 操作结果\r\n   */ async lpush(key, value) {\n        try {\n            if (this.redis) {\n                await this.redis.lpush(key, JSON.stringify(value));\n                return true;\n            } else {\n                // 使用内存存储作为后备\n                const list = this.memoryStore.get(key)?.value || [];\n                list.unshift(value);\n                this.memoryStore.set(key, {\n                    value: list,\n                    timestamp: Date.now()\n                });\n                return true;\n            }\n        } catch (error) {\n            console.error(\"Redis列表添加失败:\", error);\n            return false;\n        }\n    }\n    /**\r\n   * 获取列表所有元素\r\n   * @param {string} key - 列表键\r\n   * @returns {Promise<Array>} 列表元素\r\n   */ async lrange(key, start = 0, end = -1) {\n        try {\n            if (this.redis) {\n                const items = await this.redis.lrange(key, start, end);\n                return items.map((item)=>{\n                    try {\n                        // 如果item已经是对象，直接返回\n                        if (typeof item === \"object\" && item !== null) {\n                            return item;\n                        }\n                        // 如果是字符串，尝试解析JSON\n                        if (typeof item === \"string\") {\n                            return JSON.parse(item);\n                        }\n                        // 其他情况直接返回\n                        return item;\n                    } catch (parseError) {\n                        console.warn(`JSON解析失败，返回原始值: ${item}`, parseError);\n                        return item;\n                    }\n                });\n            } else {\n                // 使用内存存储作为后备\n                const list = this.memoryStore.get(key)?.value || [];\n                if (end === -1) end = list.length - 1;\n                return list.slice(start, end + 1);\n            }\n        } catch (error) {\n            console.error(\"Redis列表获取失败:\", error);\n            return [];\n        }\n    }\n    /**\r\n   * 从列表中移除元素\r\n   * @param {string} key - 列表键\r\n   * @param {any} value - 要移除的值\r\n   * @returns {Promise<boolean>} 操作结果\r\n   */ async lrem(key, value) {\n        try {\n            if (this.redis) {\n                await this.redis.lrem(key, 0, JSON.stringify(value));\n                return true;\n            } else {\n                // 使用内存存储作为后备\n                const list = this.memoryStore.get(key)?.value || [];\n                const index = list.findIndex((item)=>JSON.stringify(item) === JSON.stringify(value));\n                if (index !== -1) {\n                    list.splice(index, 1);\n                    this.memoryStore.set(key, {\n                        value: list,\n                        timestamp: Date.now()\n                    });\n                }\n                return true;\n            }\n        } catch (error) {\n            console.error(\"Redis列表移除失败:\", error);\n            return false;\n        }\n    }\n}\n// 创建单例实例\nconst redisClient = new RedisClient();\n\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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LEtBQUssQ0FBQ21DLElBQUksQ0FBQzNCLEtBQUssR0FBR0ksS0FBS0MsU0FBUyxDQUFDSjtnQkFDN0MsT0FBTztZQUNULE9BQU87Z0JBQ0wsYUFBYTtnQkFDYixNQUFNaUIsT0FBTyxJQUFJLENBQUN6QixXQUFXLENBQUNrQixHQUFHLENBQUNYLE1BQU1DLFNBQVMsRUFBRTtnQkFDbkQsTUFBTTJCLFFBQVFWLEtBQUtXLFNBQVMsQ0FBQ2QsQ0FBQUEsT0FBUVgsS0FBS0MsU0FBUyxDQUFDVSxVQUFVWCxLQUFLQyxTQUFTLENBQUNKO2dCQUM3RSxJQUFJMkIsVUFBVSxDQUFDLEdBQUc7b0JBQ2hCVixLQUFLWSxNQUFNLENBQUNGLE9BQU87b0JBQ25CLElBQUksQ0FBQ25DLFdBQVcsQ0FBQ00sR0FBRyxDQUFDQyxLQUFLO3dCQUFFQyxPQUFPaUI7d0JBQU1YLFdBQVdDLEtBQUtDLEdBQUc7b0JBQUc7Z0JBQ2pFO2dCQUNBLE9BQU87WUFDVDtRQUNGLEVBQUUsT0FBT0MsT0FBTztZQUNkcEIsUUFBUW9CLEtBQUssQ0FBQyxnQkFBZ0JBO1lBQzlCLE9BQU87UUFDVDtJQUNGO0FBQ0Y7QUFFQSxTQUFTO0FBQ1QsTUFBTXFCLGNBQWMsSUFBSWpEO0FBRVkiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90Zy1uZXQtYnVja2V0Ly4vc3JjL3JlZGlzX2NsaWVudC5qcz84YmY0Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFJlZGlzIH0gZnJvbSAnQHVwc3Rhc2gvcmVkaXMnO1xyXG5cclxuLyoqXHJcbiAqIFJlZGlz5a6i5oi356uv6YWN572u5ZKM6L+e5o6l566h55CGXHJcbiAqIOS9v+eUqFVwc3Rhc2ggUmVkaXPkvZzkuLrmjIHkuYXljJblrZjlgqhcclxuICovXHJcbmNsYXNzIFJlZGlzQ2xpZW50IHtcclxuICBjb25zdHJ1Y3RvcigpIHtcclxuICAgIC8vIOS7jueOr+Wig+WPmOmHj+iOt+WPllVwc3Rhc2ggUmVkaXPphY3nva5cclxuICAgIHRoaXMucmVkaXNVcmwgPSBwcm9jZXNzLmVudi5VUFNUQVNIX1JFRElTX1JFU1RfVVJMO1xyXG4gICAgdGhpcy5yZWRpc1Rva2VuID0gcHJvY2Vzcy5lbnYuVVBTVEFTSF9SRURJU19SRVNUX1RPS0VOO1xyXG4gICAgXHJcbiAgICBpZiAoIXRoaXMucmVkaXNVcmwgfHwgIXRoaXMucmVkaXNUb2tlbikge1xyXG4gICAgICBjb25zb2xlLndhcm4oJ1Vwc3Rhc2ggUmVkaXPphY3nva7mnKrmib7liLDvvIzlsIbkvb/nlKjlhoXlrZjlrZjlgqjvvIjku4XnlKjkuo7lvIDlj5Hnjq/looPvvIknKTtcclxuICAgICAgdGhpcy5yZWRpcyA9IG51bGw7XHJcbiAgICAgIHRoaXMubWVtb3J5U3RvcmUgPSBuZXcgTWFwKCk7IC8vIOW8gOWPkeeOr+Wig+eahOWGheWtmOWtmOWCqFxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgLy8g5Yid5aeL5YyWVXBzdGFzaCBSZWRpc+WuouaIt+err1xyXG4gICAgICB0aGlzLnJlZGlzID0gbmV3IFJlZGlzKHtcclxuICAgICAgICB1cmw6IHRoaXMucmVkaXNVcmwsXHJcbiAgICAgICAgdG9rZW46IHRoaXMucmVkaXNUb2tlbixcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDojrflj5ZSZWRpc+WuouaIt+err+WunuS+i1xyXG4gICAqIEByZXR1cm5zIHtSZWRpc3xudWxsfSBSZWRpc+WuouaIt+err+WunuS+i+aIlm51bGzvvIjlpoLmnpzmnKrphY3nva7vvIlcclxuICAgKi9cclxuICBnZXRDbGllbnQoKSB7XHJcbiAgICByZXR1cm4gdGhpcy5yZWRpcztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOajgOafpVJlZGlz6L+e5o6l5piv5ZCm5Y+v55SoXHJcbiAgICogQHJldHVybnMge2Jvb2xlYW59IOi/nuaOpeeKtuaAgVxyXG4gICAqL1xyXG4gIGlzQ29ubmVjdGVkKCkge1xyXG4gICAgcmV0dXJuIHRoaXMucmVkaXMgIT09IG51bGw7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDorr7nva7plK7lgLzlr7lcclxuICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IC0g6ZSuXHJcbiAgICogQHBhcmFtIHthbnl9IHZhbHVlIC0g5YC8XHJcbiAgICogQHBhcmFtIHtudW1iZXJ9IFt0dGxdIC0g6L+H5pyf5pe26Ze077yI56eS77yJXHJcbiAgICogQHJldHVybnMge1Byb21pc2U8Ym9vbGVhbj59IOaTjeS9nOe7k+aenFxyXG4gICAqL1xyXG4gIGFzeW5jIHNldChrZXksIHZhbHVlLCB0dGwgPSBudWxsKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAodGhpcy5yZWRpcykge1xyXG4gICAgICAgIGNvbnN0IHNlcmlhbGl6ZWRWYWx1ZSA9IEpTT04uc3RyaW5naWZ5KHZhbHVlKTtcclxuICAgICAgICBpZiAodHRsKSB7XHJcbiAgICAgICAgICBhd2FpdCB0aGlzLnJlZGlzLnNldGV4KGtleSwgdHRsLCBzZXJpYWxpemVkVmFsdWUpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBhd2FpdCB0aGlzLnJlZGlzLnNldChrZXksIHNlcmlhbGl6ZWRWYWx1ZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOS9v+eUqOWGheWtmOWtmOWCqOS9nOS4uuWQjuWkh1xyXG4gICAgICAgIHRoaXMubWVtb3J5U3RvcmUuc2V0KGtleSwgeyB2YWx1ZSwgdGltZXN0YW1wOiBEYXRlLm5vdygpLCB0dGwgfSk7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1JlZGlz6K6+572u5aSx6LSlOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog6I635Y+W5YC8XHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSAtIOmUrlxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPGFueXxudWxsPn0g5YC85oiWbnVsbFxyXG4gICAqL1xyXG4gIGFzeW5jIGdldChrZXkpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICh0aGlzLnJlZGlzKSB7XHJcbiAgICAgICAgY29uc3QgdmFsdWUgPSBhd2FpdCB0aGlzLnJlZGlzLmdldChrZXkpO1xyXG4gICAgICAgIGlmICghdmFsdWUpIHJldHVybiBudWxsO1xyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIOWuieWFqOeahCBKU09OIOino+aekFxyXG4gICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAvLyDlpoLmnpzlgLzlt7Lnu4/mmK/lr7nosaHvvIznm7TmjqXov5Tlm55cclxuICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB2YWx1ZTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIC8vIOWmguaenOaYr+Wtl+espuS4su+8jOWwneivleino+aekFxyXG4gICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UodmFsdWUpO1xyXG4gICAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEpTT07op6PmnpDlpLHotKXvvIxrZXk6ICR7a2V5fSwgdmFsdWU6YCwgdmFsdWUsIHBhcnNlRXJyb3IpO1xyXG4gICAgICAgICAgLy8g5aaC5p6c6Kej5p6Q5aSx6LSl77yM5Yig6Zmk5peg5pWI5pWw5o2uXHJcbiAgICAgICAgICBhd2FpdCB0aGlzLmRlbChrZXkpO1xyXG4gICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOS9v+eUqOWGheWtmOWtmOWCqOS9nOS4uuWQjuWkh1xyXG4gICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLm1lbW9yeVN0b3JlLmdldChrZXkpO1xyXG4gICAgICAgIGlmICghaXRlbSkgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8g5qOA5p+l5piv5ZCm6L+H5pyfXHJcbiAgICAgICAgaWYgKGl0ZW0udHRsICYmIChEYXRlLm5vdygpIC0gaXRlbS50aW1lc3RhbXApID4gaXRlbS50dGwgKiAxMDAwKSB7XHJcbiAgICAgICAgICB0aGlzLm1lbW9yeVN0b3JlLmRlbGV0ZShrZXkpO1xyXG4gICAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiBpdGVtLnZhbHVlO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdSZWRpc+iOt+WPluWksei0pTonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5Yig6Zmk6ZSuXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSAtIOmUrlxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSDmk43kvZznu5PmnpxcclxuICAgKi9cclxuICBhc3luYyBkZWwoa2V5KSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAodGhpcy5yZWRpcykge1xyXG4gICAgICAgIGF3YWl0IHRoaXMucmVkaXMuZGVsKGtleSk7XHJcbiAgICAgICAgcmV0dXJuIHRydWU7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8g5L2/55So5YaF5a2Y5a2Y5YKo5L2c5Li65ZCO5aSHXHJcbiAgICAgICAgcmV0dXJuIHRoaXMubWVtb3J5U3RvcmUuZGVsZXRlKGtleSk7XHJcbiAgICAgIH1cclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1JlZGlz5Yig6Zmk5aSx6LSlOicsIGVycm9yKTtcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICog5ZCR5YiX6KGo5re75Yqg5YWD57SgXHJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSAtIOWIl+ihqOmUrlxyXG4gICAqIEBwYXJhbSB7YW55fSB2YWx1ZSAtIOimgea3u+WKoOeahOWAvFxyXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSDmk43kvZznu5PmnpxcclxuICAgKi9cclxuICBhc3luYyBscHVzaChrZXksIHZhbHVlKSB7XHJcbiAgICB0cnkge1xyXG4gICAgICBpZiAodGhpcy5yZWRpcykge1xyXG4gICAgICAgIGF3YWl0IHRoaXMucmVkaXMubHB1c2goa2V5LCBKU09OLnN0cmluZ2lmeSh2YWx1ZSkpO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOS9v+eUqOWGheWtmOWtmOWCqOS9nOS4uuWQjuWkh1xyXG4gICAgICAgIGNvbnN0IGxpc3QgPSB0aGlzLm1lbW9yeVN0b3JlLmdldChrZXkpPy52YWx1ZSB8fCBbXTtcclxuICAgICAgICBsaXN0LnVuc2hpZnQodmFsdWUpO1xyXG4gICAgICAgIHRoaXMubWVtb3J5U3RvcmUuc2V0KGtleSwgeyB2YWx1ZTogbGlzdCwgdGltZXN0YW1wOiBEYXRlLm5vdygpIH0pO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdSZWRpc+WIl+ihqOa3u+WKoOWksei0pTonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIOiOt+WPluWIl+ihqOaJgOacieWFg+e0oFxyXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgLSDliJfooajplK5cclxuICAgKiBAcmV0dXJucyB7UHJvbWlzZTxBcnJheT59IOWIl+ihqOWFg+e0oFxyXG4gICAqL1xyXG4gIGFzeW5jIGxyYW5nZShrZXksIHN0YXJ0ID0gMCwgZW5kID0gLTEpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGlmICh0aGlzLnJlZGlzKSB7XHJcbiAgICAgICAgY29uc3QgaXRlbXMgPSBhd2FpdCB0aGlzLnJlZGlzLmxyYW5nZShrZXksIHN0YXJ0LCBlbmQpO1xyXG4gICAgICAgIHJldHVybiBpdGVtcy5tYXAoaXRlbSA9PiB7XHJcbiAgICAgICAgICB0cnkge1xyXG4gICAgICAgICAgICAvLyDlpoLmnpxpdGVt5bey57uP5piv5a+56LGh77yM55u05o6l6L+U5ZueXHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgaXRlbSA9PT0gJ29iamVjdCcgJiYgaXRlbSAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgIHJldHVybiBpdGVtO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIOWmguaenOaYr+Wtl+espuS4su+8jOWwneivleino+aekEpTT05cclxuICAgICAgICAgICAgaWYgKHR5cGVvZiBpdGVtID09PSAnc3RyaW5nJykge1xyXG4gICAgICAgICAgICAgIHJldHVybiBKU09OLnBhcnNlKGl0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIOWFtuS7luaDheWGteebtOaOpei/lOWbnlxyXG4gICAgICAgICAgICByZXR1cm4gaXRlbTtcclxuICAgICAgICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS53YXJuKGBKU09O6Kej5p6Q5aSx6LSl77yM6L+U5Zue5Y6f5aeL5YC8OiAke2l0ZW19YCwgcGFyc2VFcnJvcik7XHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOS9v+eUqOWGheWtmOWtmOWCqOS9nOS4uuWQjuWkh1xyXG4gICAgICAgIGNvbnN0IGxpc3QgPSB0aGlzLm1lbW9yeVN0b3JlLmdldChrZXkpPy52YWx1ZSB8fCBbXTtcclxuICAgICAgICBpZiAoZW5kID09PSAtMSkgZW5kID0gbGlzdC5sZW5ndGggLSAxO1xyXG4gICAgICAgIHJldHVybiBsaXN0LnNsaWNlKHN0YXJ0LCBlbmQgKyAxKTtcclxuICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignUmVkaXPliJfooajojrflj5blpLHotKU6JywgZXJyb3IpO1xyXG4gICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiDku47liJfooajkuK3np7vpmaTlhYPntKBcclxuICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IC0g5YiX6KGo6ZSuXHJcbiAgICogQHBhcmFtIHthbnl9IHZhbHVlIC0g6KaB56e76Zmk55qE5YC8XHJcbiAgICogQHJldHVybnMge1Byb21pc2U8Ym9vbGVhbj59IOaTjeS9nOe7k+aenFxyXG4gICAqL1xyXG4gIGFzeW5jIGxyZW0oa2V5LCB2YWx1ZSkge1xyXG4gICAgdHJ5IHtcclxuICAgICAgaWYgKHRoaXMucmVkaXMpIHtcclxuICAgICAgICBhd2FpdCB0aGlzLnJlZGlzLmxyZW0oa2V5LCAwLCBKU09OLnN0cmluZ2lmeSh2YWx1ZSkpO1xyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIOS9v+eUqOWGheWtmOWtmOWCqOS9nOS4uuWQjuWkh1xyXG4gICAgICAgIGNvbnN0IGxpc3QgPSB0aGlzLm1lbW9yeVN0b3JlLmdldChrZXkpPy52YWx1ZSB8fCBbXTtcclxuICAgICAgICBjb25zdCBpbmRleCA9IGxpc3QuZmluZEluZGV4KGl0ZW0gPT4gSlNPTi5zdHJpbmdpZnkoaXRlbSkgPT09IEpTT04uc3RyaW5naWZ5KHZhbHVlKSk7XHJcbiAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkge1xyXG4gICAgICAgICAgbGlzdC5zcGxpY2UoaW5kZXgsIDEpO1xyXG4gICAgICAgICAgdGhpcy5tZW1vcnlTdG9yZS5zZXQoa2V5LCB7IHZhbHVlOiBsaXN0LCB0aW1lc3RhbXA6IERhdGUubm93KCkgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdSZWRpc+WIl+ihqOenu+mZpOWksei0pTonLCBlcnJvcik7XHJcbiAgICAgIHJldHVybiBmYWxzZTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbi8vIOWIm+W7uuWNleS+i+WunuS+i1xyXG5jb25zdCByZWRpc0NsaWVudCA9IG5ldyBSZWRpc0NsaWVudCgpO1xyXG5cclxuZXhwb3J0IHsgcmVkaXNDbGllbnQsIFJlZGlzQ2xpZW50IH07Il0sIm5hbWVzIjpbIlJlZGlzIiwiUmVkaXNDbGllbnQiLCJjb25zdHJ1Y3RvciIsInJlZGlzVXJsIiwicHJvY2VzcyIsImVudiIsIlVQU1RBU0hfUkVESVNfUkVTVF9VUkwiLCJyZWRpc1Rva2VuIiwiVVBTVEFTSF9SRURJU19SRVNUX1RPS0VOIiwiY29uc29sZSIsIndhcm4iLCJyZWRpcyIsIm1lbW9yeVN0b3JlIiwiTWFwIiwidXJsIiwidG9rZW4iLCJnZXRDbGllbnQiLCJpc0Nvbm5lY3RlZCIsInNldCIsImtleSIsInZhbHVlIiwidHRsIiwic2VyaWFsaXplZFZhbHVlIiwiSlNPTiIsInN0cmluZ2lmeSIsInNldGV4IiwidGltZXN0YW1wIiwiRGF0ZSIsIm5vdyIsImVycm9yIiwiZ2V0IiwicGFyc2UiLCJwYXJzZUVycm9yIiwiZGVsIiwiaXRlbSIsImRlbGV0ZSIsImxwdXNoIiwibGlzdCIsInVuc2hpZnQiLCJscmFuZ2UiLCJzdGFydCIsImVuZCIsIml0ZW1zIiwibWFwIiwibGVuZ3RoIiwic2xpY2UiLCJscmVtIiwiaW5kZXgiLCJmaW5kSW5kZXgiLCJzcGxpY2UiLCJyZWRpc0NsaWVudCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/redis_client.js\n");

/***/ }),

/***/ "(api)/./src/telegram_storage.js":
/*!*********************************!*\
  !*** ./src/telegram_storage.js ***!
  \*********************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TelegramStorage: () => (/* binding */ TelegramStorage)\n/* harmony export */ });\n/* harmony import */ var node_telegram_bot_api__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! node-telegram-bot-api */ \"node-telegram-bot-api\");\n/* harmony import */ var node_telegram_bot_api__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(node_telegram_bot_api__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var axios__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! axios */ \"axios\");\n/* harmony import */ var _redis_client_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./redis_client.js */ \"(api)/./src/redis_client.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([axios__WEBPACK_IMPORTED_MODULE_1__, _redis_client_js__WEBPACK_IMPORTED_MODULE_2__]);\n([axios__WEBPACK_IMPORTED_MODULE_1__, _redis_client_js__WEBPACK_IMPORTED_MODULE_2__] = __webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__);\n\n\n\nclass TelegramStorage {\n    constructor(options){\n        this.botToken = options.botToken;\n        this.chatId = options.chatId;\n        // 允许注入客户端用于测试\n        this.telegramClient = options.telegramClient || new (node_telegram_bot_api__WEBPACK_IMPORTED_MODULE_0___default())(this.botToken, {\n            polling: false\n        });\n    }\n    /**\n   * 上传文件到Telegram\n   * @param {Buffer} fileBuffer - 文件内容的Buffer\n   * @param {string} fileName - 文件名\n   * @returns {Promise<{fileId: string, messageId: string}>} - 上传结果\n   */ async uploadFile(fileBuffer, fileName) {\n        try {\n            // 使用正确的文件选项格式来避免废弃警告\n            const response = await this.telegramClient.sendDocument(this.chatId, fileBuffer, {}, {\n                filename: fileName,\n                contentType: \"application/octet-stream\"\n            });\n            const fileInfo = {\n                fileId: response.document?.file_id || \"\",\n                messageId: response.message_id.toString(),\n                fileName: fileName,\n                fileSize: response.document?.file_size || fileBuffer.length,\n                uploadTime: new Date().toISOString(),\n                chatId: this.chatId\n            };\n            // 将文件信息存储到Redis中\n            const fileListKey = `files:${this.chatId}`;\n            await _redis_client_js__WEBPACK_IMPORTED_MODULE_2__.redisClient.lpush(fileListKey, fileInfo);\n            // 设置文件信息的单独键，方便快速查找\n            const fileKey = `file:${fileInfo.fileId}`;\n            await _redis_client_js__WEBPACK_IMPORTED_MODULE_2__.redisClient.set(fileKey, fileInfo, 86400 * 30); // 30天过期\n            return {\n                fileId: fileInfo.fileId,\n                messageId: fileInfo.messageId\n            };\n        } catch (error) {\n            console.error(\"上传文件到Telegram失败:\", error);\n            throw new Error(`上传文件失败: ${error.message}`);\n        }\n    }\n    /**\n   * 从Telegram下载文件\n   * @param {string} fileId - 文件ID\n   * @returns {Promise<string>} - 文件下载链接\n   */ async downloadFile(fileId) {\n        try {\n            const file = await this.telegramClient.getFile(fileId);\n            const fileLink = await this.telegramClient.getFileLink(file.file_id);\n            return fileLink;\n        } catch (error) {\n            console.error(\"从Telegram下载文件失败:\", error);\n            throw new Error(`下载文件失败: ${error.message}`);\n        }\n    }\n    /**\n   * 获取文件信息\n   * @param {string} fileId - 文件ID\n   * @returns {Promise<Object>} - 文件信息对象\n   */ async getFileInfo(fileId) {\n        try {\n            // 首先尝试从Redis获取文件信息\n            const fileKey = `file:${fileId}`;\n            let fileInfo = await _redis_client_js__WEBPACK_IMPORTED_MODULE_2__.redisClient.get(fileKey);\n            if (fileInfo) {\n                return fileInfo;\n            }\n            // 如果Redis中没有，尝试从文件列表中查找\n            const files = await this.listFiles();\n            fileInfo = files.find((file)=>file.fileId === fileId);\n            if (fileInfo) {\n                // 将找到的文件信息存储到Redis\n                await _redis_client_js__WEBPACK_IMPORTED_MODULE_2__.redisClient.set(fileKey, fileInfo, 86400 * 30); // 30天过期\n                return fileInfo;\n            }\n            throw new Error(\"文件信息未找到\");\n        } catch (error) {\n            console.error(\"获取文件信息失败:\", error);\n            throw new Error(`获取文件信息失败: ${error.message}`);\n        }\n    }\n    /**\n   * 列出文件列表\n   * 优先从Redis获取，如果Redis为空则从Telegram同步\n   * @returns {Promise<Array<{fileId: string, fileName: string, messageId: string}>>} - 文件列表\n   */ async listFiles() {\n        try {\n            const fileListKey = `files:${this.chatId}`;\n            // 首先尝试从Redis获取文件列表\n            let files = await _redis_client_js__WEBPACK_IMPORTED_MODULE_2__.redisClient.lrange(fileListKey);\n            // 如果Redis中没有数据，从Telegram同步\n            if (!files || files.length === 0) {\n                console.log(\"Redis中无文件列表，从Telegram同步...\");\n                files = await this.syncFilesFromTelegram();\n            }\n            // 按上传时间倒序排列（最新的在前面）\n            files.sort((a, b)=>new Date(b.uploadTime) - new Date(a.uploadTime));\n            return files;\n        } catch (error) {\n            console.error(\"列出文件失败:\", error);\n            throw new Error(`列出文件失败: ${error.message}`);\n        }\n    }\n    /**\n   * 从Telegram同步文件列表到Redis\n   * @returns {Promise<Array>} 同步的文件列表\n   */ async syncFilesFromTelegram() {\n        try {\n            // 使用getUpdates获取最近的消息（包含文档的消息）\n            const updates = await this.telegramClient.getUpdates({\n                limit: 100,\n                allowed_updates: [\n                    \"message\"\n                ] // 只获取消息更新\n            });\n            const files = [];\n            const fileListKey = `files:${this.chatId}`;\n            // 遍历更新，查找包含文档的消息\n            for (const update of updates){\n                if (update.message && update.message.chat.id.toString() === this.chatId.toString() && update.message.document) {\n                    const doc = update.message.document;\n                    const fileInfo = {\n                        fileId: doc.file_id,\n                        fileName: doc.file_name || `document_${doc.file_id.slice(-8)}`,\n                        messageId: update.message.message_id.toString(),\n                        fileSize: doc.file_size,\n                        uploadTime: new Date(update.message.date * 1000).toISOString(),\n                        chatId: this.chatId\n                    };\n                    files.push(fileInfo);\n                    // 将文件信息存储到Redis\n                    await _redis_client_js__WEBPACK_IMPORTED_MODULE_2__.redisClient.lpush(fileListKey, fileInfo);\n                    // 设置文件信息的单独键\n                    const fileKey = `file:${fileInfo.fileId}`;\n                    await _redis_client_js__WEBPACK_IMPORTED_MODULE_2__.redisClient.set(fileKey, fileInfo, 86400 * 30); // 30天过期\n                }\n            }\n            console.log(`从Telegram同步了 ${files.length} 个文件到Redis`);\n            return files;\n        } catch (error) {\n            console.error(\"从Telegram同步文件失败:\", error);\n            return [];\n        }\n    }\n    /**\n   * 从Telegram删除文件\n   * @param {string} messageId - 消息ID\n   * @returns {Promise<boolean>} - 删除结果\n   */ async deleteFile(messageId) {\n        try {\n            // 从Telegram删除消息\n            await this.telegramClient.deleteMessage(this.chatId, messageId);\n            // 从Redis中删除文件信息\n            const fileListKey = `files:${this.chatId}`;\n            const files = await _redis_client_js__WEBPACK_IMPORTED_MODULE_2__.redisClient.lrange(fileListKey);\n            // 找到要删除的文件\n            const fileToDelete = files.find((file)=>file.messageId === messageId);\n            if (fileToDelete) {\n                // 从文件列表中移除\n                await _redis_client_js__WEBPACK_IMPORTED_MODULE_2__.redisClient.lrem(fileListKey, fileToDelete);\n                // 删除文件的单独键\n                const fileKey = `file:${fileToDelete.fileId}`;\n                await _redis_client_js__WEBPACK_IMPORTED_MODULE_2__.redisClient.del(fileKey);\n                console.log(`已从Redis删除文件: ${fileToDelete.fileName}`);\n            }\n            return true;\n        } catch (error) {\n            console.error(\"从Telegram删除文件失败:\", error);\n            throw new Error(`删除文件失败: ${error.message}`);\n        }\n    }\n}\n\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YnVja2V0Ly4vc3JjL3RlbGVncmFtX3N0b3JhZ2UuanM/ZmEzZCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgVGVsZWdyYW1Cb3QgZnJvbSAnbm9kZS10ZWxlZ3JhbS1ib3QtYXBpJztcbmltcG9ydCBheGlvcyBmcm9tICdheGlvcyc7XG5pbXBvcnQgeyByZWRpc0NsaWVudCB9IGZyb20gJy4vcmVkaXNfY2xpZW50LmpzJztcblxuY2xhc3MgVGVsZWdyYW1TdG9yYWdlIHtcbiAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgIHRoaXMuYm90VG9rZW4gPSBvcHRpb25zLmJvdFRva2VuO1xuICAgIHRoaXMuY2hhdElkID0gb3B0aW9ucy5jaGF0SWQ7XG4gICAgXG4gICAgLy8g5YWB6K645rOo5YWl5a6i5oi356uv55So5LqO5rWL6K+VXG4gICAgdGhpcy50ZWxlZ3JhbUNsaWVudCA9IG9wdGlvbnMudGVsZWdyYW1DbGllbnQgfHwgbmV3IFRlbGVncmFtQm90KHRoaXMuYm90VG9rZW4sIHsgcG9sbGluZzogZmFsc2UgfSk7XG4gIH1cblxuICAvKipcbiAgICog5LiK5Lyg5paH5Lu25YiwVGVsZWdyYW1cbiAgICogQHBhcmFtIHtCdWZmZXJ9IGZpbGVCdWZmZXIgLSDmlofku7blhoXlrrnnmoRCdWZmZXJcbiAgICogQHBhcmFtIHtzdHJpbmd9IGZpbGVOYW1lIC0g5paH5Lu25ZCNXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPHtmaWxlSWQ6IHN0cmluZywgbWVzc2FnZUlkOiBzdHJpbmd9Pn0gLSDkuIrkvKDnu5PmnpxcbiAgICovXG4gIGFzeW5jIHVwbG9hZEZpbGUoZmlsZUJ1ZmZlciwgZmlsZU5hbWUpIHtcbiAgICB0cnkge1xuICAgICAgLy8g5L2/55So5q2j56Gu55qE5paH5Lu26YCJ6aG55qC85byP5p2l6YG/5YWN5bqf5byD6K2m5ZGKXG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHRoaXMudGVsZWdyYW1DbGllbnQuc2VuZERvY3VtZW50KHRoaXMuY2hhdElkLCBmaWxlQnVmZmVyLCB7fSwge1xuICAgICAgICBmaWxlbmFtZTogZmlsZU5hbWUsXG4gICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJ1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGZpbGVJbmZvID0ge1xuICAgICAgICBmaWxlSWQ6IHJlc3BvbnNlLmRvY3VtZW50Py5maWxlX2lkIHx8ICcnLFxuICAgICAgICBtZXNzYWdlSWQ6IHJlc3BvbnNlLm1lc3NhZ2VfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgZmlsZU5hbWU6IGZpbGVOYW1lLFxuICAgICAgICBmaWxlU2l6ZTogcmVzcG9uc2UuZG9jdW1lbnQ/LmZpbGVfc2l6ZSB8fCBmaWxlQnVmZmVyLmxlbmd0aCxcbiAgICAgICAgdXBsb2FkVGltZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICBjaGF0SWQ6IHRoaXMuY2hhdElkXG4gICAgICB9O1xuICAgICAgXG4gICAgICAvLyDlsIbmlofku7bkv6Hmga/lrZjlgqjliLBSZWRpc+S4rVxuICAgICAgY29uc3QgZmlsZUxpc3RLZXkgPSBgZmlsZXM6JHt0aGlzLmNoYXRJZH1gO1xuICAgICAgYXdhaXQgcmVkaXNDbGllbnQubHB1c2goZmlsZUxpc3RLZXksIGZpbGVJbmZvKTtcbiAgICAgIFxuICAgICAgLy8g6K6+572u5paH5Lu25L+h5oGv55qE5Y2V54us6ZSu77yM5pa55L6/5b+r6YCf5p+l5om+XG4gICAgICBjb25zdCBmaWxlS2V5ID0gYGZpbGU6JHtmaWxlSW5mby5maWxlSWR9YDtcbiAgICAgIGF3YWl0IHJlZGlzQ2xpZW50LnNldChmaWxlS2V5LCBmaWxlSW5mbywgODY0MDAgKiAzMCk7IC8vIDMw5aSp6L+H5pyfXG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGZpbGVJZDogZmlsZUluZm8uZmlsZUlkLFxuICAgICAgICBtZXNzYWdlSWQ6IGZpbGVJbmZvLm1lc3NhZ2VJZFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign5LiK5Lyg5paH5Lu25YiwVGVsZWdyYW3lpLHotKU6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGDkuIrkvKDmlofku7blpLHotKU6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5LuOVGVsZWdyYW3kuIvovb3mlofku7ZcbiAgICogQHBhcmFtIHtzdHJpbmd9IGZpbGVJZCAtIOaWh+S7tklEXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPHN0cmluZz59IC0g5paH5Lu25LiL6L296ZO+5o6lXG4gICAqL1xuICBhc3luYyBkb3dubG9hZEZpbGUoZmlsZUlkKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGZpbGUgPSBhd2FpdCB0aGlzLnRlbGVncmFtQ2xpZW50LmdldEZpbGUoZmlsZUlkKTtcbiAgICAgIGNvbnN0IGZpbGVMaW5rID0gYXdhaXQgdGhpcy50ZWxlZ3JhbUNsaWVudC5nZXRGaWxlTGluayhmaWxlLmZpbGVfaWQpO1xuICAgICAgcmV0dXJuIGZpbGVMaW5rO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfku45UZWxlZ3JhbeS4i+i9veaWh+S7tuWksei0pTonLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYOS4i+i9veaWh+S7tuWksei0pTogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDojrflj5bmlofku7bkv6Hmga9cbiAgICogQHBhcmFtIHtzdHJpbmd9IGZpbGVJZCAtIOaWh+S7tklEXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPE9iamVjdD59IC0g5paH5Lu25L+h5oGv5a+56LGhXG4gICAqL1xuICBhc3luYyBnZXRGaWxlSW5mbyhmaWxlSWQpIHtcbiAgICB0cnkge1xuICAgICAgLy8g6aaW5YWI5bCd6K+V5LuOUmVkaXPojrflj5bmlofku7bkv6Hmga9cbiAgICAgIGNvbnN0IGZpbGVLZXkgPSBgZmlsZToke2ZpbGVJZH1gO1xuICAgICAgbGV0IGZpbGVJbmZvID0gYXdhaXQgcmVkaXNDbGllbnQuZ2V0KGZpbGVLZXkpO1xuICAgICAgXG4gICAgICBpZiAoZmlsZUluZm8pIHtcbiAgICAgICAgcmV0dXJuIGZpbGVJbmZvO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyDlpoLmnpxSZWRpc+S4reayoeacie+8jOWwneivleS7juaWh+S7tuWIl+ihqOS4reafpeaJvlxuICAgICAgY29uc3QgZmlsZXMgPSBhd2FpdCB0aGlzLmxpc3RGaWxlcygpO1xuICAgICAgZmlsZUluZm8gPSBmaWxlcy5maW5kKGZpbGUgPT4gZmlsZS5maWxlSWQgPT09IGZpbGVJZCk7XG4gICAgICBcbiAgICAgIGlmIChmaWxlSW5mbykge1xuICAgICAgICAvLyDlsIbmib7liLDnmoTmlofku7bkv6Hmga/lrZjlgqjliLBSZWRpc1xuICAgICAgICBhd2FpdCByZWRpc0NsaWVudC5zZXQoZmlsZUtleSwgZmlsZUluZm8sIDg2NDAwICogMzApOyAvLyAzMOWkqei/h+acn1xuICAgICAgICByZXR1cm4gZmlsZUluZm87XG4gICAgICB9XG4gICAgICBcbiAgICAgIHRocm93IG5ldyBFcnJvcign5paH5Lu25L+h5oGv5pyq5om+5YiwJyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+iOt+WPluaWh+S7tuS/oeaBr+Wksei0pTonLCBlcnJvcik7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYOiOt+WPluaWh+S7tuS/oeaBr+Wksei0pTogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiDliJflh7rmlofku7bliJfooahcbiAgICog5LyY5YWI5LuOUmVkaXPojrflj5bvvIzlpoLmnpxSZWRpc+S4uuepuuWImeS7jlRlbGVncmFt5ZCM5q2lXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPEFycmF5PHtmaWxlSWQ6IHN0cmluZywgZmlsZU5hbWU6IHN0cmluZywgbWVzc2FnZUlkOiBzdHJpbmd9Pj59IC0g5paH5Lu25YiX6KGoXG4gICAqL1xuICBhc3luYyBsaXN0RmlsZXMoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGZpbGVMaXN0S2V5ID0gYGZpbGVzOiR7dGhpcy5jaGF0SWR9YDtcbiAgICAgIFxuICAgICAgLy8g6aaW5YWI5bCd6K+V5LuOUmVkaXPojrflj5bmlofku7bliJfooahcbiAgICAgIGxldCBmaWxlcyA9IGF3YWl0IHJlZGlzQ2xpZW50LmxyYW5nZShmaWxlTGlzdEtleSk7XG4gICAgICBcbiAgICAgIC8vIOWmguaenFJlZGlz5Lit5rKh5pyJ5pWw5o2u77yM5LuOVGVsZWdyYW3lkIzmraVcbiAgICAgIGlmICghZmlsZXMgfHwgZmlsZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdSZWRpc+S4reaXoOaWh+S7tuWIl+ihqO+8jOS7jlRlbGVncmFt5ZCM5q2lLi4uJyk7XG4gICAgICAgIGZpbGVzID0gYXdhaXQgdGhpcy5zeW5jRmlsZXNGcm9tVGVsZWdyYW0oKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8g5oyJ5LiK5Lyg5pe26Ze05YCS5bqP5o6S5YiX77yI5pyA5paw55qE5Zyo5YmN6Z2i77yJXG4gICAgICBmaWxlcy5zb3J0KChhLCBiKSA9PiBuZXcgRGF0ZShiLnVwbG9hZFRpbWUpIC0gbmV3IERhdGUoYS51cGxvYWRUaW1lKSk7XG4gICAgICBcbiAgICAgIHJldHVybiBmaWxlcztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign5YiX5Ye65paH5Lu25aSx6LSlOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihg5YiX5Ye65paH5Lu25aSx6LSlOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIOS7jlRlbGVncmFt5ZCM5q2l5paH5Lu25YiX6KGo5YiwUmVkaXNcbiAgICogQHJldHVybnMge1Byb21pc2U8QXJyYXk+fSDlkIzmraXnmoTmlofku7bliJfooahcbiAgICovXG4gIGFzeW5jIHN5bmNGaWxlc0Zyb21UZWxlZ3JhbSgpIHtcbiAgICB0cnkge1xuICAgICAgLy8g5L2/55SoZ2V0VXBkYXRlc+iOt+WPluacgOi/keeahOa2iOaBr++8iOWMheWQq+aWh+aho+eahOa2iOaBr++8iVxuICAgICAgY29uc3QgdXBkYXRlcyA9IGF3YWl0IHRoaXMudGVsZWdyYW1DbGllbnQuZ2V0VXBkYXRlcyh7XG4gICAgICAgIGxpbWl0OiAxMDAsIC8vIOiOt+WPluacgOi/kTEwMOadoeabtOaWsFxuICAgICAgICBhbGxvd2VkX3VwZGF0ZXM6IFsnbWVzc2FnZSddIC8vIOWPquiOt+WPlua2iOaBr+abtOaWsFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGZpbGVzID0gW107XG4gICAgICBjb25zdCBmaWxlTGlzdEtleSA9IGBmaWxlczoke3RoaXMuY2hhdElkfWA7XG4gICAgICBcbiAgICAgIC8vIOmBjeWOhuabtOaWsO+8jOafpeaJvuWMheWQq+aWh+aho+eahOa2iOaBr1xuICAgICAgZm9yIChjb25zdCB1cGRhdGUgb2YgdXBkYXRlcykge1xuICAgICAgICBpZiAodXBkYXRlLm1lc3NhZ2UgJiYgXG4gICAgICAgICAgICB1cGRhdGUubWVzc2FnZS5jaGF0LmlkLnRvU3RyaW5nKCkgPT09IHRoaXMuY2hhdElkLnRvU3RyaW5nKCkgJiZcbiAgICAgICAgICAgIHVwZGF0ZS5tZXNzYWdlLmRvY3VtZW50KSB7XG4gICAgICAgICAgXG4gICAgICAgICAgY29uc3QgZG9jID0gdXBkYXRlLm1lc3NhZ2UuZG9jdW1lbnQ7XG4gICAgICAgICAgY29uc3QgZmlsZUluZm8gPSB7XG4gICAgICAgICAgICBmaWxlSWQ6IGRvYy5maWxlX2lkLFxuICAgICAgICAgICAgZmlsZU5hbWU6IGRvYy5maWxlX25hbWUgfHwgYGRvY3VtZW50XyR7ZG9jLmZpbGVfaWQuc2xpY2UoLTgpfWAsXG4gICAgICAgICAgICBtZXNzYWdlSWQ6IHVwZGF0ZS5tZXNzYWdlLm1lc3NhZ2VfaWQudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIGZpbGVTaXplOiBkb2MuZmlsZV9zaXplLFxuICAgICAgICAgICAgdXBsb2FkVGltZTogbmV3IERhdGUodXBkYXRlLm1lc3NhZ2UuZGF0ZSAqIDEwMDApLnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgICBjaGF0SWQ6IHRoaXMuY2hhdElkXG4gICAgICAgICAgfTtcbiAgICAgICAgICBcbiAgICAgICAgICBmaWxlcy5wdXNoKGZpbGVJbmZvKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyDlsIbmlofku7bkv6Hmga/lrZjlgqjliLBSZWRpc1xuICAgICAgICAgIGF3YWl0IHJlZGlzQ2xpZW50LmxwdXNoKGZpbGVMaXN0S2V5LCBmaWxlSW5mbyk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8g6K6+572u5paH5Lu25L+h5oGv55qE5Y2V54us6ZSuXG4gICAgICAgICAgY29uc3QgZmlsZUtleSA9IGBmaWxlOiR7ZmlsZUluZm8uZmlsZUlkfWA7XG4gICAgICAgICAgYXdhaXQgcmVkaXNDbGllbnQuc2V0KGZpbGVLZXksIGZpbGVJbmZvLCA4NjQwMCAqIDMwKTsgLy8gMzDlpKnov4fmnJ9cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zb2xlLmxvZyhg5LuOVGVsZWdyYW3lkIzmraXkuoYgJHtmaWxlcy5sZW5ndGh9IOS4quaWh+S7tuWIsFJlZGlzYCk7XG4gICAgICByZXR1cm4gZmlsZXM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+S7jlRlbGVncmFt5ZCM5q2l5paH5Lu25aSx6LSlOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICog5LuOVGVsZWdyYW3liKDpmaTmlofku7ZcbiAgICogQHBhcmFtIHtzdHJpbmd9IG1lc3NhZ2VJZCAtIOa2iOaBr0lEXG4gICAqIEByZXR1cm5zIHtQcm9taXNlPGJvb2xlYW4+fSAtIOWIoOmZpOe7k+aenFxuICAgKi9cbiAgYXN5bmMgZGVsZXRlRmlsZShtZXNzYWdlSWQpIHtcbiAgICB0cnkge1xuICAgICAgLy8g5LuOVGVsZWdyYW3liKDpmaTmtojmga9cbiAgICAgIGF3YWl0IHRoaXMudGVsZWdyYW1DbGllbnQuZGVsZXRlTWVzc2FnZSh0aGlzLmNoYXRJZCwgbWVzc2FnZUlkKTtcbiAgICAgIFxuICAgICAgLy8g5LuOUmVkaXPkuK3liKDpmaTmlofku7bkv6Hmga9cbiAgICAgIGNvbnN0IGZpbGVMaXN0S2V5ID0gYGZpbGVzOiR7dGhpcy5jaGF0SWR9YDtcbiAgICAgIGNvbnN0IGZpbGVzID0gYXdhaXQgcmVkaXNDbGllbnQubHJhbmdlKGZpbGVMaXN0S2V5KTtcbiAgICAgIFxuICAgICAgLy8g5om+5Yiw6KaB5Yig6Zmk55qE5paH5Lu2XG4gICAgICBjb25zdCBmaWxlVG9EZWxldGUgPSBmaWxlcy5maW5kKGZpbGUgPT4gZmlsZS5tZXNzYWdlSWQgPT09IG1lc3NhZ2VJZCk7XG4gICAgICBpZiAoZmlsZVRvRGVsZXRlKSB7XG4gICAgICAgIC8vIOS7juaWh+S7tuWIl+ihqOS4reenu+mZpFxuICAgICAgICBhd2FpdCByZWRpc0NsaWVudC5scmVtKGZpbGVMaXN0S2V5LCBmaWxlVG9EZWxldGUpO1xuICAgICAgICBcbiAgICAgICAgLy8g5Yig6Zmk5paH5Lu255qE5Y2V54us6ZSuXG4gICAgICAgIGNvbnN0IGZpbGVLZXkgPSBgZmlsZToke2ZpbGVUb0RlbGV0ZS5maWxlSWR9YDtcbiAgICAgICAgYXdhaXQgcmVkaXNDbGllbnQuZGVsKGZpbGVLZXkpO1xuICAgICAgICBcbiAgICAgICAgY29uc29sZS5sb2coYOW3suS7jlJlZGlz5Yig6Zmk5paH5Lu2OiAke2ZpbGVUb0RlbGV0ZS5maWxlTmFtZX1gKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+S7jlRlbGVncmFt5Yig6Zmk5paH5Lu25aSx6LSlOicsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihg5Yig6Zmk5paH5Lu25aSx6LSlOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCB7IFRlbGVncmFtU3RvcmFnZSB9OyJdLCJuYW1lcyI6WyJUZWxlZ3JhbUJvdCIsImF4aW9zIiwicmVkaXNDbGllbnQiLCJUZWxlZ3JhbVN0b3JhZ2UiLCJjb25zdHJ1Y3RvciIsIm9wdGlvbnMiLCJib3RUb2tlbiIsImNoYXRJZCIsInRlbGVncmFtQ2xpZW50IiwicG9sbGluZyIsInVwbG9hZEZpbGUiLCJmaWxlQnVmZmVyIiwiZmlsZU5hbWUiLCJyZXNwb25zZSIsInNlbmREb2N1bWVudCIsImZpbGVuYW1lIiwiY29udGVudFR5cGUiLCJmaWxlSW5mbyIsImZpbGVJZCIsImRvY3VtZW50IiwiZmlsZV9pZCIsIm1lc3NhZ2VJZCIsIm1lc3NhZ2VfaWQiLCJ0b1N0cmluZyIsImZpbGVTaXplIiwiZmlsZV9zaXplIiwibGVuZ3RoIiwidXBsb2FkVGltZSIsIkRhdGUiLCJ0b0lTT1N0cmluZyIsImZpbGVMaXN0S2V5IiwibHB1c2giLCJmaWxlS2V5Iiwic2V0IiwiZXJyb3IiLCJjb25zb2xlIiwiRXJyb3IiLCJtZXNzYWdlIiwiZG93bmxvYWRGaWxlIiwiZmlsZSIsImdldEZpbGUiLCJmaWxlTGluayIsImdldEZpbGVMaW5rIiwiZ2V0RmlsZUluZm8iLCJnZXQiLCJmaWxlcyIsImxpc3RGaWxlcyIsImZpbmQiLCJscmFuZ2UiLCJsb2ciLCJzeW5jRmlsZXNGcm9tVGVsZWdyYW0iLCJzb3J0IiwiYSIsImIiLCJ1cGRhdGVzIiwiZ2V0VXBkYXRlcyIsImxpbWl0IiwiYWxsb3dlZF91cGRhdGVzIiwidXBkYXRlIiwiY2hhdCIsImlkIiwiZG9jIiwiZmlsZV9uYW1lIiwic2xpY2UiLCJkYXRlIiwicHVzaCIsImRlbGV0ZUZpbGUiLCJkZWxldGVNZXNzYWdlIiwiZmlsZVRvRGVsZXRlIiwibHJlbSIsImRlbCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./src/telegram_storage.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Ffiles&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cfiles.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();