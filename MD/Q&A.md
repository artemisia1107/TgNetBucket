# 常见问题与故障排除

## 🔧 故障排除

### 文件上传失败 (500错误)

如果遇到文件上传失败的问题，请检查以下几点：

#### 1. 环境变量配置
- 确保 `TELEGRAM_BOT_TOKEN` 和 `TELEGRAM_CHAT_ID` 已正确配置
- 在Vercel部署时，需要在项目设置的Environment Variables中添加这些变量
- 检查环境变量值是否包含多余的空格或特殊字符

#### 2. Bot权限检查
- 确保Bot有权限向指定的聊天发送消息
- 如果使用群组ID，确保Bot已被添加到群组中
- 验证Bot是否被禁用或删除

#### 3. 文件大小限制
- Telegram Bot API对文件大小有限制（最大50MB）
- 确保上传的文件不超过此限制
- 建议单文件大小控制在25MB以内以确保稳定性

#### 4. 网络连接问题
- 检查服务器是否能正常访问Telegram API
- 确认防火墙设置没有阻止相关请求
- 验证DNS解析是否正常

### Redis连接问题

#### 连接失败
1. 检查`UPSTASH_REDIS_REST_URL`和`UPSTASH_REDIS_REST_TOKEN`是否正确配置
2. 确认Upstash Redis数据库状态正常
3. 验证网络连接和防火墙设置
4. 如果Redis不可用，系统会自动降级到内存存储，不影响基本功能

#### 数据同步问题
- 如果Redis数据丢失，系统会自动从Telegram历史消息恢复
- 手动触发同步：访问管理面板的"同步文件列表"功能
- 检查Redis存储配额是否已满

### 部署相关问题

#### Vercel部署失败
1. 检查项目依赖是否完整（运行`npm install`）
2. 确认所有环境变量已正确配置
3. 查看Vercel的Function Logs获取详细错误信息
4. 验证项目结构是否符合Next.js要求

#### 环境变量不生效
- 确保在Vercel项目设置中正确添加了环境变量
- 重新部署项目以使环境变量生效
- 检查变量名是否拼写正确（区分大小写）

---

## ❓ 常见问题

### 基础使用问题

**Q: 为什么文件列表为空？**

A: 可能的原因和解决方案：
- **未配置Redis**: 如果未配置Redis，文件列表基于内存存储，应用重启后会丢失。配置Upstash Redis可以解决此问题
- **Redis连接问题**: 如果已配置Redis但仍为空，请检查Redis连接配置是否正确
- **首次使用**: 如果是首次使用，需要先上传文件才会显示列表
- **同步问题**: 访问管理面板，使用"同步文件列表"功能手动同步

**Q: 如何获取Chat ID？**

A: 有以下几种方法：
1. **通过Bot获取**: 向Bot发送消息，然后访问 `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates` 查看消息中的chat id
2. **使用第三方Bot**: 向 [@userinfobot](https://t.me/userinfobot) 发送消息获取你的用户ID
3. **群组ID获取**: 将Bot添加到群组，然后通过getUpdates API获取群组ID（通常为负数）

**Q: 支持哪些文件类型？**

A: 支持所有常见文件类型，包括：
- 📄 文档：PDF, DOC, DOCX, PPT, PPTX, XLS, XLSX, TXT等
- 🖼️ 图片：JPG, PNG, GIF, BMP, SVG, WebP等
- 🎵 音频：MP3, WAV, FLAC, AAC, OGG等
- 🎬 视频：MP4, AVI, MKV, MOV, WMV等
- 📦 压缩文件：ZIP, RAR, 7Z, TAR等
- 💻 程序文件：EXE, APK, DEB等

详细支持列表请参考README中的"支持的文件类型和大小限制"部分。

### 技术配置问题

**Q: 部署后仍然出现500错误？**

A: 排查步骤：
1. 检查Vercel的Function Logs，查看详细的错误信息
2. 确认所有环境变量已正确配置
3. 验证Telegram Bot Token和Chat ID的有效性
4. 检查Bot是否有发送消息的权限
5. 确认文件大小没有超过50MB限制

**Q: Redis连接失败怎么办？**

A: 解决方案：
1. 检查`UPSTASH_REDIS_REST_URL`和`UPSTASH_REDIS_REST_TOKEN`是否正确配置
2. 确认Upstash Redis数据库状态正常
3. 验证网络连接和防火墙设置
4. 如果Redis不可用，系统会自动降级到内存存储，不影响基本功能
5. 可以暂时移除Redis配置，使用内存存储模式

**Q: 如何监控Redis使用情况？**

A: 监控方法：
- 登录Upstash控制台查看数据库使用统计
- 查看请求次数、存储大小、连接数等信息
- 设置使用量告警，避免超出配额
- 定期清理过期数据

### 功能使用问题

**Q: 文件上传后按钮不显示？**

A: 这通常是文件列表同步问题：
- **配置Redis**: 配置Redis后，文件信息会持久化存储，确保上传后能正确显示操作按钮
- **刷新页面**: 尝试刷新页面重新加载文件列表
- **检查上传状态**: 确认文件是否真正上传成功
- **手动同步**: 在管理面板中使用同步功能

**Q: 下载速度很慢怎么办？**

A: 优化建议：
- 文件下载速度主要取决于Telegram服务器和用户网络
- 尝试在网络状况较好的时间段下载
- 对于大文件，建议分批下载或使用下载工具
- 检查本地网络连接是否稳定

**Q: 可以批量上传文件吗？**

A: 当前版本限制：
- 为避免API限制冲突，目前只支持单文件上传
- 可以通过拖拽多个文件到上传区域，系统会依次处理
- 建议将多个小文件打包成压缩包后上传

### 安全和隐私问题

**Q: 文件存储安全吗？**

A: 安全考虑：
- 文件存储在Telegram服务器，请遵守相关法律法规
- 不建议存储包含个人隐私或商业机密的文件
- 建议对重要文件进行加密后再上传
- 定期清理不需要的文件

**Q: 其他人能访问我的文件吗？**

A: 访问控制：
- 只有拥有正确Bot Token和Chat ID的人才能管理文件
- 文件下载链接是临时的，有一定的安全性
- 建议不要分享Bot配置信息给他人
- 可以定期更换Bot Token增强安全性

---

## 🆘 获取帮助

如果以上解答没有解决你的问题，可以通过以下方式获取帮助：

1. **GitHub Issues**: 在项目仓库提交Issue，描述具体问题和错误信息
2. **查看日志**: 检查Vercel Function Logs或浏览器控制台的错误信息
3. **社区讨论**: 参与项目的Discussions讨论
4. **文档参考**: 查看项目中的其他文档文件（ARCHITECTURE.md、UPSTASH_SETUP.md等）

### 提交问题时请包含：
- 详细的错误描述和复现步骤
- 错误截图或日志信息
- 使用的浏览器和操作系统版本
- 部署环境信息（本地开发/Vercel部署）
- 相关的配置信息（隐藏敏感信息）